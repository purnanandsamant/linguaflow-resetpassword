<!DOCTYPE html>
<html>
<head>
  <title>Reset Password</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Initialize Supabase client
    const supabaseUrl = 'https://bzagepvymwyxvohfkzob.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6YWdlcHZ5bXd5eHZvaGZrem9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NzkwODAsImV4cCI6MjA1ODA1NTA4MH0.CboeMGJ8j8g7UPBATJctyLDA03vw7ppn3aYViTlYLbg'; // Your public anon key
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Extract token from URL
    const params = new URLSearchParams(window.location.hash.substring(1));
    const accessToken = params.get('access_token');
    const refreshToken = params.get('refresh_token');
    const type = params.get('type');
    
    async function resetPassword() {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (password !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      
      if (accessToken) {
        try {
          // Set the session first
          await supabase.auth.setSession({
            access_token: accessToken,
            refresh_token: refreshToken
          });
          
          // Then update the password
          const { error } = await supabase.auth.updateUser({
            password: password
          });
          
          if (error) {
            document.getElementById('error').textContent = error.message;
          } else {
            document.getElementById('success').style.display = 'block';
            document.getElementById('resetForm').style.display = 'none';
          }
        } catch (err) {
          document.getElementById('error').textContent = err.message;
        }
      } else {
        document.getElementById('error').textContent = 'No reset token found in URL';
      }
    }
    
    function openApp() {
      window.location.href = 'languagetranslator23://auth';
    }
  </script>
</head>
<body>
  <div id="resetForm">
    <h1>Reset Your Password</h1>
    <div id="error" style="color: red;"></div>
    <div>
      <label for="password">New Password:</label>
      <input type="password" id="password" />
    </div>
    <div>
      <label for="confirmPassword">Confirm Password:</label>
      <input type="password" id="confirmPassword" />
    </div>
    <button onclick="resetPassword()">Reset Password</button>
  </div>
  
  <div id="success" style="display: none;">
    <h1>Password Reset Successful!</h1>
    <p>Your password has been reset successfully.</p>
    <button onclick="openApp()">Return to App</button>
  </div>
</body>
</html>
